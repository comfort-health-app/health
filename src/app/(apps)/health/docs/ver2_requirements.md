# 新機能要件定義書

## 病院データ管理機能

**概要:** 通院先の病院、診療科、担当医を管理するマスタ機能。

- **データ項目:**
  - 病院名（例：東京病院）
  - 診療科（例：皮膚科）
  - 先生名（例：田中先生）
- **挙動:**
  - 先生が交代した場合は、既存データの名前を上書き更新する（履歴データは過去のまま保持し、マスタの「箱」は引き継ぐ運用）。

## 3. 通院履歴

**概要:** 診察の記録を残す機能。

- **データ項目:**
  - 日時（日付と時刻）
  - どの病院（病院マスタから選択）
  - その時の科
  - その時の先生
  - 処置内容（テキスト）
  - 先生からのコメント（テキスト・処置内容とは分ける）,
  - 備考
  - 画像（複数登録可 / 1回の通院で大量に撮影するため複数枚対応必須）
- **表示仕様:**
  - 新しい日付順に表示。
  - 病院ごとのフィルタリング（絞り込み）機能。
  - 一覧表示画面では最新の履歴が上に来るようにする。

## 4. 病院ごとのタスク管理（掲示板）

**概要:** 次回の診察までに必要な準備（検尿セット持参、薬の受け取り等）を管理する,。

- **データ項目:**
  - 期限（＝次の診療日など）
  - 内容
  - 備考
  - 画像（複数可・薬のパッケージなど）,
- **表示仕様:**
  - 病院ごとにグループ化して表示
  - 完了したタスクはチェックを入れて消し込みを行う。
  - ダッシュボードにも期限当日のタスクを表示する。

## 5. Googleカレンダー連携

**概要:** Googleカレンダーの特定の予定をアプリ内に取り込み、ダッシュボードに表示する。

- **連携ロジック:**
  - 全ての予定に加え「病院」に関する予定は強調して表示する。
  - **判定条件:** タイトルや内容に「病院」という漢字2文字が含まれている予定を抽出する。
- **同期タイミング:**
  - 基本は「更新ボタン」を押したときの手動同期（通信負荷軽減のため）。
  - バックグラウンドでは1時間に1回程度のキャッシュ更新（自動更新）を行う。

## 6. 購入品リスト

**概要:** 「買いたいもの」から「購入・受取・領収書発行」までのステータスを管理する。スマホ画面での視認性を考慮し、テーブル形式ではなく**カード形式**での表示を想定。

### A. データフローと入力項目

**フェーズ1：「買いたい」時に登録（新規作成）**

- 注文品（名称）
- 依頼者
- 区分：ネット / 直接（ラジオボタン等で選択）
- 期限
- 画像（複数可）

**フェーズ2：「買った時」に登録（更新1）**

- 注文者
- 支払方法
  - 「直接」の場合：**「現金」**固定（自動入力）
- 決済日
  - 「直接」の場合：**登録日時**を自動入力
- 到着予定日
  - 「ネット」の場合：手動入力
  - 「直接」の場合：**登録日時**を自動入力（即時受取のため）
- 領収書出力日
  - 「直接」の場合：**登録日時**を自動入力（その場で受領するため）
- **UI制御:** 「区分：直接」が選択されている場合、上記自動入力項目はユーザーの手入力をスキップさせる（または非表示にする）ことで負担を減らす。

**フェーズ3：受け取った時に入力（更新2）**

- 受取者
- 受取確認日
  - 「直接」の場合：**登録日時**を自動入力

**随時入力**

- 備考
- 画像（追加登録可）

### B. フィルタ・アラート表示

- **基本フィルタ（掛け合わせ可能）:**
  1. 区分：直接 / ネット
  2. ステータス：購入済 / 未購入
- **アラート表示（やり残し確認）:**
  - **「未到着 / 未領収書」フィルタ（ネット限定）**
    - ネット購入分で、「到着していない」または「領収書が出力されていない」ものを抽出表示する機能,。

## ダッシュボード（新設 / トップページ）

**概要:** アプリ起動時に最初に表示される画面。スマホでの閲覧を前提とし、その月の予定と直近のタスクを一元管理する。

- **表示形式:**
  - 画面上部：月表示のカレンダー。クリックすることで詳細を表示。
  - 画面下部：その日の「予定、タスク、病院タスク、購入品」
- **表示内容:**
  - Googleカレンダーの予定（病院関連のみ）。
  - その日が期限の「病院タスク」。
  - その日が期限の「購入品」。
  - 予定がない日は日付のみ表示。
